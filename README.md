# DNS\_YES\_BOT — Telegram-бот для компании DNS

**DNS\_YES\_BOT** — это внутренний Telegram-бот, разработанный на C# с использованием библиотеки Telegram.Bot. Он автоматизирует процесс сбора подтверждений прочтения от магазинов сети DNS. Бот позволяет отслеживать, какие магазины ознакомились с опубликованными в общем канале объявлениями, управлять списком администраторов и проводить опросы/голосования с последующим сбором результатов. Проект реализован как набор микросервисов на .NET, которые обмениваются данными в формате JSON, а взаимодействие с ботом и веб-интерфейсом организовано через ASP.NET Core API. Для развёртывания используется Docker и Docker Compose.

## Основные функции

* **Сбор подтверждений прочтения:** бот отслеживает, какие магазины нажали на кнопку своего магазина после публикации сообщения в канале. Таким образом можно увидеть, кто из магазинов ознакомился с информацией.
* **Управление администраторами:** через специальные команды бота можно добавлять и удалять администраторов, а также просматривать текущий список администраторов.
* **Проведение голосований и отображение результатов:** бот запускает «голосование» (раздачу кнопок) в канале, а затем сохраняет результаты (какие магазины нажали на свои кнопки). Администраторы могут получить результаты голосования в табличном виде.

## Технологии

Проект реализован на современном стеке технологий Microsoft:

* **C# (.NET 8/9):** основной язык разработки микросервисов и бота.
* **Telegram.Bot:** библиотека для работы с Telegram Bot API.
* **ASP.NET Core:** используется для создания Web API, через который веб-интерфейс и сервисы обмениваются данными.
* **Blazor (ASP.NET Core Blazor):** применяется для веб-интерфейса администраторов (панели управления).
* **Docker и Docker Compose:** контейнеризация сервисов и упрощённое развертывание проекта.

## Архитектура проекта

Проект имеет модульную структуру и разделён на несколько компонентов (микросервисов):

* **BotService:** главный сервис для запуска и управления ботом. Отвечает за получение обновлений от Telegram и отправку сообщений/кнопок.
* **EventHandlers:** обработчики событий бота (получение сообщений, нажатий на кнопки и т.д.). Реагирует на команды и callback-запросы.
* **RouteTelegramData:** логика маршрутизации данных между ботом и другими службами. Например, направляет данные о нажатиях кнопок в сервис голосования или сервис магазинов.
* **ShopService:** сервис для управления данными о магазинах (например, список магазинов региона, их привязка к чатам и т.д.).
* **UserService:** сервис для работы с пользователями и администраторами (хранение списка администраторов, управление доступом).
* **VoteService:** сервис для проведения «голосований» и обработки их результатов (учёт нажатий и генерация отчётов).

Каждый из этих компонентов является отдельным проектом внутри решения и может запускаться независимо (микросервисный подход). Коммуникация между сервисами и ботом осуществляется через JSON и HTTP-запросы к API, что упрощает масштабирование и модульность системы.

## Команды бота

Бот поддерживает команды как в групповых чатах (каналах и группах), так и в личных сообщениях:

* **Для групповых чатов** (каналов/групп): доступны команды `/start`, `/results`, `/add_admin`, `/help`. Эти команды, как правило, используются в канале сообщества DNS для начала голосования, просмотра результатов, добавления новых администраторов и получения справки.
* **Для личных сообщений с ботом:** доступны команды `/admin_service`, `/show_admins`, `/vote_cancel`, `/help`. Команда `/admin_service` открывает панель управления (админский интерфейс), `/show_admins` показывает список текущих администраторов, `/vote_cancel` позволяет администратору досрочно завершить текущее голосование, а `/help` выводит справочную информацию.

Благодаря этому набору команд администраторы могут запускать и контролировать процесс оповещения и голосования через бот.

## Сценарий использования

Обычный сценарий работы бота следующий:

1. **Публикация информации:** В общем канале компании DNS публикуется важное сообщение для магазинов региона (например, объявление или инструкция). Администратор запускает бота в комментариях к этому сообщению.
2. **Выдача кнопок:** Бот формирует список магазинов (загружая их из ShopService) и выводит его в виде кнопок под сообщением. Каждый магазин соответствует своей кнопке.
3. **Подтверждение прочтения:** Представители магазина нажимают на кнопку своего магазина, подтверждая, что они ознакомились с информацией. При нажатии бот отправляет запрос в VoteService, который фиксирует, что данное имя/ID магазина нажало кнопку.
4. **Сбор данных:** Все сведения (кто какую кнопку нажал) сохраняются в формате JSON между сервисами и сохраняются для последующего анализа.
5. **Просмотр результатов:** Администратор в личном чате с ботом может запросить результаты голосования (например, через команду `/admin_service`). Бот выдаёт уникальную ссылку (GUID, действующую 24 часа), перейдя по которой администратор попадает на веб-страницу. Эта страница (реализована на Blazor) отображает таблицу: названия магазинов и имена (или идентификаторы) тех, кто нажал кнопку за каждый магазин. Таким образом видно, какие магазины подтвердили ознакомление, а какие – нет.

Таким образом бот упрощает процесс рассылки и контроля информации по магазинам DNS: вместо того, чтобы вручную собирать подтверждения, бот автоматизирует весь цикл от публикации до отчёта.

## Развёртывание и запуск

Для запуска проекта в рабочем режиме используется Docker Compose. Шаги по развёртыванию:

1. **Установите Docker и Docker Compose** на машину, где будет запускаться сервис.
2. **Склонируйте репозиторий проекта:**

   ```bash
   git clone https://github.com/ваш-username/Yes_Bot.git
   cd Yes_Bot
   ```

   (Замените `ваш-username` на имя своего репозитория или склонируйте напрямую с данного URL, если это публичная копия).
3. **Создайте файл `.env`** в корне проекта и добавьте в него токен вашего Telegram-бота:

   ```
   TELEGRAM_BOT_TOKEN=ваш_токен
   ```

   (Токен можно получить у [@BotFather](https://t.me/BotFather) в Telegram).
4. **Запустите проект:** выполните команду

   ```bash
   docker-compose up --build -d
   ```

   Это создаст и запустит все контейнеры с сервисами бота. После успешного запуска API бота будет доступен на `http://localhost:7030` (порт можно настроить в файле `docker-compose.yml`).

После этого бот будет работать в режиме реального времени: он подключится к Telegram, начнёт слушать команды и сможет обрабатывать ответы магазинов.

## Лицензия

Проект распространяется под лицензией **MIT**.
